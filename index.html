<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>genius</title>
    <style>
        body { font-family: sans-serif; background: #000; color: #fff; max-width: 600px; margin: 40px auto; padding: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #444; background: #111; color: #fff; box-sizing: border-box; }
        button { padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .btn-search { background: #ffff64; color: #000; }
        .btn-copy { background: #333; color: #fff; width: 48%; display: none; }
        .result-item { background: #1a1a1a; padding: 12px; margin: 8px 0; border-radius: 6px; cursor: pointer; border: 1px solid #333; }
        .result-item:hover { border-color: #ffff64; }
        #lyrics-output { white-space: pre-wrap; background: #0a0a0a; padding: 20px; border-radius: 10px; display: none; border: 1px solid #222; margin-top: 20px; font-family: serif; font-size: 1.1em; line-height: 1.6; }
        #status { color: #888; text-align: center; margin: 10px 0; font-size: 0.9em; }
    </style>
</head>
<body>

    <h2>Genius Lyrics Scraper</h2>
    <input type="text" id="songInput" placeholder="Song Name">
    <input type="text" id="artistInput" placeholder="Artist Name (Optional)">
    <button class="btn-search" onclick="search()">Search</button>
    
    <div id="status">Ready</div>
    <div id="results"></div>

    <div style="display: flex; justify-content: space-between;">
        <button id="btnFull" class="btn-copy" onclick="copy('full')">Copy Full</button>
        <button id="btnClean" class="btn-copy" onclick="copy('clean')">Copy Clean</button>
    </div>

    <div id="lyrics-output"></div>

<script>
    let rawLyrics = "";
    // Using a "Cross-Origin" proxy to bypass browser security
    const PROXY = "https://corsproxy.io/?";

    async function search() {
        const song = document.getElementById('songInput').value;
        const artist = document.getElementById('artistInput').value;
        if (!song) return;

        updateStatus("Searching...");
        const query = encodeURIComponent(`${song} ${artist}`);
        const url = `https://genius.com/api/search/multi?q=${query}`;
        
        try {
            const response = await fetch(PROXY + encodeURIComponent(url));
            const data = await response.json();
            const songs = data.response.sections.find(s => s.type === "song").hits;

            let html = "";
            songs.forEach(hit => {
                const s = hit.result;
                html += `<div class="result-item" onclick="getLyrics('${s.url}')">
                            <strong>${s.title}</strong><br><small style="color:#888">${s.artist_names}</small>
                         </div>`;
            });
            document.getElementById('results').innerHTML = html;
            updateStatus("Select a song below:");
        } catch (e) {
            updateStatus("Search Failed. The proxy might be down.");
            console.error(e);
        }
    }

    async function getLyrics(url) {
        updateStatus("Scraping lyrics...");
        try {
            const response = await fetch(PROXY + encodeURIComponent(url));
            const html = await response.text();
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const containers = doc.querySelectorAll('[data-lyrics-container="true"]');
            
            let text = "";
            if (containers.length > 0) {
                containers.forEach(c => {
                    // Fix line breaks
                    c.querySelectorAll('br').forEach(br => br.replaceWith('\n'));
                    text += c.textContent + "\n";
                });
            } else {
                text = doc.querySelector('.lyrics')?.textContent || "Could not find lyrics content.";
            }

            rawLyrics = text.trim();
            const output = document.getElementById('lyrics-output');
            output.innerText = rawLyrics;
            output.style.display = "block";
            
            document.getElementById('btnFull').style.display = "block";
            document.getElementById('btnClean').style.display = "block";
            updateStatus("Lyrics Loaded!");
        } catch (e) {
            updateStatus("Error fetching lyrics.");
        }
    }

    function updateStatus(msg) {
        document.getElementById('status').innerText = msg;
    }

    function copy(mode) {
        let text = rawLyrics;
        if (mode === 'clean') {
            // Removes [Intro], [Verse], etc. and fixes spacing
            text = text.replace(/\[.*?\]/g, "").replace(/\n\s*\n/g, "\n\n");
        }
        
        const el = document.createElement('textarea');
        el.value = text.trim();
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        alert(mode.toUpperCase() + " lyrics copied!");
    }
</script>
</body>
</html>
